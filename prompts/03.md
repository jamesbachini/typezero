## Task 3/5 â€” RiscZero guest + host prover: parse replay, enforce rules, compute score, commit journal

**You are Codex. Implement this task fully before moving on. Run proving once and run tests.**

### Goal

Implement the smallest possible zk program that:

* parses encoded replay
* enforces timing plausibility checks
* computes deterministic score (wpm + accuracy)
* commits a fixed struct to journal
  Implement host to generate proof artifacts and print/return:
* `seal` hex
* `image_id` hex
* `journal_sha256` hex
* decoded committed outputs (score etc.)

### Inputs (guest reads, in this order)

* `challenge_id: u32`
* `prompt_hash: [u8; 32]`
* `player_pubkey: [u8; 32]`
* `prompt_bytes: Vec<u8>` (normalized prompt bytes, to compare & hash)
* `events_bytes: Vec<u8>` (canonical encoding)

### Canonical encoding (MUST match `shared/`)

* `len: u16 little-endian`
* then `len` records of:

  * `dt_ms: u16 little-endian`
  * `key: u8`
    Key map (minimum):
* 0..25 => 'a'..'z'
* 26 => space
* 27 => backspace
* 28 => enter (optional end)

### Guest rules (small)

* Validate `sha256(prompt_bytes) == prompt_hash`
* Parse events, reconstruct typed output
* Enforce:

  * `dt_ms >= 10`
  * total duration >= `prompt_len * 40` ms
  * reject invalid keys
* Scoring:

  * `duration_ms = sum(dt_ms)`
  * `typed_chars = number of non-backspace chars that remain`
  * `correct_chars = count matches vs prompt at same index (up to min len)`
  * `accuracy_bps = (correct_chars * 10000) / prompt_len`
  * `wpm_x100 = ((typed_chars * 1200 * 100) / duration_ms)`  (since WPM=(chars/5)/minutes; derive integer form)
  * `score = (wpm_x100 as u64 * accuracy_bps as u64) / 10000`
* Commit journal struct (fixed order):

  * `challenge_id: u32`
  * `player_pubkey: [u8;32]`
  * `prompt_hash: [u8;32]`
  * `score: u64`
  * `wpm_x100: u32`
  * `accuracy_bps: u32`
  * `duration_ms: u32`

### Host prover

* Provide a CLI or library used by backend:

  * `prove(challenge_id, player_pubkey, prompt, events_bytes)` returns:

    * computed outputs
    * `seal`
    * `image_id`
    * `journal_sha256`

### Unit tests (must)

* 3 fixtures:

  * perfect run => expected accuracy 10000
  * some mistakes => accuracy < 10000
  * invalid dt => guest panics / prove fails
* Determinism: same inputs -> same `journal_sha256`

### Commands you MUST run

* `cargo test` in risc0 workspace
* run host once to print sample output (`cargo run --release ...`)

### Output

Document:

* replay encoding
* scoring formula
* committed journal layout (byte/field order)
